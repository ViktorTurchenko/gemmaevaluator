# Overview
This repository contains a FastAPI application designed to evaluate essays and determine if they were composed by an AI. The application uses a pre-trained language model from Hugging Face, specifically the "google/gemma-2b-it" model. The application is containerized using Docker for ease of deployment and scalability.

# Features
- **API Endpoint:**  The application provides a /generate/ endpoint that receives a text prompt (an essay) and returns an evaluation of whether the essay was generated by AI.
- **Scalability:** The application is designed to be scalable with the ability to increase the number of workers handling incoming requests.
- **Resource Optimization:** Currently configured to run on limited CPU resources to ensure compatibility with environments where GPU resources are not available.

# Prerequisites
- Docker installed on your machine.
- An API token from Hugging Face. You will need this token to authenticate with the Hugging Face model repository.

# Running the Application
### Building the Docker Image
To build the Docker image for this application, navigate to the directory containing the Dockerfile and run the following command:

```bash
docker build -t essay-evaluator .
```
This command builds a Docker image named **essay-evaluator** based on the instructions in your Dockerfile.

### Running the Docker Container
Run the Docker container using the following command, replacing **your_huggingface_token_here** with your actual Hugging Face API token:

```bash
docker run -p 8000:8000 -e HF_TOKEN=your_huggingface_token_here essay-evaluator
```

This command starts the container and makes the FastAPI application accessible on http://localhost:8000. The API token is passed securely as an environment variable. You need the API token in order to download the tokenizer and the model from HuggingFace which then will be ran locally.

### Scalability
This application can be scaled to handle more requests by increasing the number of Gunicorn workers. To do this, adjust the -w parameter in the Docker CMD directive within the Dockerfile. Here's how you can modify it to use more workers:

```bash
CMD ["gunicorn", "main:app", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "--timeout", "0", "--bind", "0.0.0.0:8000"]
```

### Considerations
- **CPU Usage:** Increasing the number of workers will increase CPU usage. Ensure the deployment environment has sufficient CPU resources to handle the additional load.
- **Load Balancing:** For significant scaling across multiple machines or high-availability setups, consider using a load balancer in front of the Docker containers to distribute incoming traffic evenly.

# Testing on FastAPI
You can further test the application on FastAPI by opening http://localhost:8000/docs# and sending a request. The request body should be of the following format:
```bash
{
  "prompt": "There's a shift happening. Folks are driving less, opting for alternative transportation, and embracing a car-lite lifestyle. You might be wondering, what's going on? Why are people willingly giving up their wheels? Well, there are a host of reasons, and I'm here to break them down for you. First off, limiting car usage means fewer emissions. Think about it: the less we drive, the cleaner the air we breathe. According to the New York Times, transportation is the second largest source of Americas emissions, just behind power plants (Rosenthal, 2013). By driving less, we can significantly reduce our carbon footprint. In fact, one study found that driving by young people decreased 23 percent between 2001 and 2009 (The End of Car Culture, 2013). ",
  "max_length": 2000
}
```
The expected response should be the following:
```bash
{
  "result": "The essay is about the shift towards a car-lite lifestyle. It provides various reasons for this shift, including the environmental benefits of driving less, the shift towards alternative transportation, and the embrace of a car-lite lifestyle. The essay is well-written and provides a clear overview of the topic. However, it is difficult to determine if it was written by an AI or a human, as the essay contains some stylistic features that are often associated with AI, such as the use of bullet points and numbered lists. Additionally, the essay's tone is somewhat objective and non-judgmental, which could indicate that it was written by an AI.<eos>"
}
```
